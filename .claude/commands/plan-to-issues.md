---
description: "Convert a plan file to GitHub issues (epic + sub-issues)"
argument-hint: "[plan-file-path]"
allowed-tools:
  - Read
  - Glob
  - Bash(gh:*)
  - Bash(ls:*)
  - AskUserQuestion
model: sonnet
---

# Plan to GitHub Issues Converter

Convert a Claude Code plan file into GitHub issues, automatically creating either a single issue with a checklist or a parent epic with linked child issues.

## Prerequisites Check

Before proceeding, verify the environment is properly configured:

1. **Check gh CLI authentication:**
   Run `gh auth status` to verify the user is authenticated with GitHub.
   - If not authenticated, display: "Error: Not authenticated with GitHub. Run `gh auth login` to authenticate."
   - Exit gracefully if authentication fails.

2. **Check repository context:**
   Run `gh repo view` to verify we are in a git repository with a GitHub remote.
   - If not in a repo or no GitHub remote, display: "Error: Not in a git repository with a GitHub remote. Navigate to a valid repository."
   - Exit gracefully if this check fails.

3. **Check gh CLI installed:**
   If the gh commands fail with "command not found", display: "Error: GitHub CLI (gh) is not installed. Install it from https://cli.github.com/"

## Plan Discovery

Locate the plan file to process:

1. **If $ARGUMENTS is provided:**
   - Use the provided path as the plan file location.
   - Verify the file exists using Read tool.
   - If file not found, display: "Error: Plan file not found at: [path]"

2. **If no argument provided:**
   - Look for the most recent .md file in `~/.claude/plans/` using: `ls -t ~/.claude/plans/*.md 2>/dev/null | head -1`
   - If no plans found, display: "Error: No plan files found in ~/.claude/plans/. Provide a path as an argument or create a plan first."
   - Use the most recent file found.

3. **Read the plan file** using the Read tool and store its contents for parsing.

## Parse Plan Structure

Extract the following elements from the plan file:

### Title Extraction
Look for the title in this order of priority:
1. `# Plan:` heading - extract text after "Plan:"
2. `## Goal` section - use first line of content under this heading
3. First `#` heading in the document
4. Filename without extension as fallback

### Description Extraction
Look for description in this order:
1. `## Approach` section content
2. First paragraph after the title heading
3. `## Overview` section content
4. `## Description` section content

### Steps Extraction
Look for implementation steps in these formats:
1. `## Implementation Plan` section with numbered items
2. `## Step N:` sections (e.g., "## Step 1: Setup", "## Step 2: Implementation")
3. `## Steps` section with numbered list
4. Top-level numbered lists (1., 2., 3., etc.)
5. `## Tasks` section with bullet or numbered items

For each step, extract:
- Step number/order
- Step title (text before any colon or first sentence)
- Step details (remaining content)

### Files Extraction
Look for file references in:
1. `## Files to Modify` section
2. `## Affected Files` section
3. `## Files` section
4. Code blocks with file paths
5. Inline file paths (paths containing `/` or `\`)

## Complexity Decision

Determine the issue structure based on step count:

**Simple Plan (1-3 steps):**
- Create a single GitHub issue
- Include all steps as a Markdown task checklist in the issue body
- Format: `- [ ] Step description`

**Complex Plan (4+ steps):**
- Create a parent "epic" issue first
- Create individual child issues for each step
- Link children to parent using "Part of #[parent-number]" in child body
- Parent issue body lists all child issues

## User Confirmation

Before creating any issues, use AskUserQuestion to get user approval:

Display a preview showing:
```
Plan to Issues Preview
======================
Plan Title: [extracted title]
Source File: [plan file path]

Structure: [Single Issue with Checklist | Epic with N Child Issues]

Issues to Create:
- [If single] 1 issue with N checklist items
- [If epic] 1 parent epic + N child issues

Labels: plan, automated

Proceed with issue creation? (yes/no)
```

Wait for user confirmation before proceeding. If user declines, exit gracefully with "Issue creation cancelled."

## Issue Creation

### For Simple Plans (Single Issue)

Create one issue with a task checklist:

```bash
gh issue create \
  --title "[Plan Title]" \
  --body "$(cat <<'EOF'
## Description

[Extracted description]

## Tasks

- [ ] [Step 1]
- [ ] [Step 2]
- [ ] [Step 3]

## Files to Modify

[List of files if extracted]

---
*Source: [plan file path]*
*Generated by plan-to-issues command*
EOF
)" \
  --label "plan" \
  --label "automated"
```

### For Complex Plans (Epic + Children)

**Step 1: Create Parent Epic**

```bash
gh issue create \
  --title "[Epic] [Plan Title]" \
  --body "$(cat <<'EOF'
## Description

[Extracted description]

## Implementation Steps

This epic tracks the following implementation tasks:

1. [ ] Step 1 title
2. [ ] Step 2 title
3. [ ] Step 3 title
...

## Files to Modify

[List of files if extracted]

---
*Source: [plan file path]*
*Generated by plan-to-issues command*
EOF
)" \
  --label "plan" \
  --label "automated" \
  --label "epic"
```

Capture the created issue number from the output URL (e.g., `https://github.com/owner/repo/issues/123` -> `123`).

**Step 2: Create Child Issues**

For each step, create a child issue:

```bash
gh issue create \
  --title "[Step N] [Step Title]" \
  --body "$(cat <<'EOF'
Part of #[parent-issue-number]

## Description

[Step details]

## Acceptance Criteria

- [ ] Implementation complete
- [ ] Tests added/updated
- [ ] Documentation updated (if applicable)

---
*Generated by plan-to-issues command*
EOF
)" \
  --label "plan" \
  --label "automated"
```

**Step 3: Update Parent with Child Links**

After creating all children, optionally update the parent epic body to include direct links to child issues.

## Report Results

After successful creation, display a summary:

```
Issue Creation Complete
=======================

Created Issues:
- [Epic] Plan Title: https://github.com/owner/repo/issues/123
  - [Step 1] First Step: https://github.com/owner/repo/issues/124
  - [Step 2] Second Step: https://github.com/owner/repo/issues/125
  ...

Or for single issue:
- Plan Title: https://github.com/owner/repo/issues/123

Total: N issue(s) created
Labels applied: plan, automated
```

## Error Handling

Handle these error conditions gracefully:

1. **gh CLI not installed:**
   - Message: "Error: GitHub CLI (gh) is not installed. Install it from https://cli.github.com/"

2. **Not authenticated:**
   - Message: "Error: Not authenticated with GitHub. Run `gh auth login` to authenticate."

3. **Not in a git repository:**
   - Message: "Error: Not in a git repository. Navigate to a repository directory."

4. **No GitHub remote:**
   - Message: "Error: This repository does not have a GitHub remote configured."

5. **Plan file not found:**
   - Message: "Error: Plan file not found at: [path]. Verify the path and try again."

6. **No plans available:**
   - Message: "Error: No plan files found in ~/.claude/plans/. Create a plan first or provide a file path as an argument."

7. **Issue creation failed:**
   - Display the gh CLI error message
   - Message: "Error: Failed to create issue. Check your permissions and try again."

8. **Empty or unparseable plan:**
   - Message: "Error: Could not parse plan file. Ensure it has a title and at least one step."
